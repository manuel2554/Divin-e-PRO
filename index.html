<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Divine — SPA Preview</title>

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              divineBg: "#07070A",
              divineCream: "#F5EFE6",
              divineGold: "#C7A35C",
              divinePanel: "rgba(255,255,255,0.06)",
              divineLine: "rgba(255,255,255,0.10)",
            },
            boxShadow: {
              divine: "0 30px 80px rgba(0,0,0,0.60)",
            },
            letterSpacing: {
              luxe: "0.18em",
            },
          },
        },
      };
    </script>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <style>
      :root { color-scheme: dark; }
      html, body { height: 100%; }
      body{
        margin:0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        background:
          radial-gradient(1200px 600px at 70% 10%, rgba(199, 163, 92, 0.12), transparent 60%),
          radial-gradient(900px 500px at 20% 40%, rgba(255, 255, 255, 0.06), transparent 60%),
          #07070a;
        color:#f5efe6;
      }
      ::selection { background: rgba(199,163,92,0.35); }
      .divine-noise{
        position:fixed; inset:0; pointer-events:none; opacity:.05;
        background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      }
      .line-clamp-2{
        display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
      }
    </style>

    <!-- React + ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Framer Motion (UMD) -->
    <script src="https://cdn.jsdelivr.net/npm/framer-motion@11/dist/framer-motion.umd.js"></script>

    <!-- Three.js (UMD) -->
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

    <!-- Babel (JSX en el navegador) -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  </head>

  <body>
    <div class="divine-noise"></div>
    <div id="root"></div>

    <script type="text/babel" data-presets="env,react">
      const React = window.React;
      const { useEffect, useMemo, useRef, useState } = React;

      // ---- Framer Motion fallback (para que NUNCA rompa si el CDN falla)
      const FM = window.framerMotion || {};

      function stripMotionProps(props = {}) {
        const clean = { ...props };
        [
          "initial","animate","exit","transition","whileHover","whileInView",
          "viewport","layout","variants"
        ].forEach((k) => delete clean[k]);
        return clean;
      }

      function createMotionFallback() {
        return new Proxy({}, {
          get: (_, tag) => (props) => {
            const { children, ...rest } = props || {};
            return React.createElement(tag, stripMotionProps(rest), children);
          }
        });
      }

      const motion = FM.motion || createMotionFallback();
      const AnimatePresence =
        FM.AnimatePresence || (({ children }) => React.createElement(React.Fragment, null, children));

      // ---- Utils
      const money = (n) => new Intl.NumberFormat("en-US", { style: "currency", currency: "USD" }).format(n);

      function useLockBodyScroll(locked) {
        useEffect(() => {
          if (!locked) return;
          const prev = document.body.style.overflow;
          document.body.style.overflow = "hidden";
          return () => { document.body.style.overflow = prev; };
        }, [locked]);
      }

      function useEscape(handler, active = true) {
        useEffect(() => {
          if (!active) return;
          const onKeyDown = (e) => e.key === "Escape" && handler?.();
          window.addEventListener("keydown", onKeyDown);
          return () => window.removeEventListener("keydown", onKeyDown);
        }, [handler, active]);
      }

      // ---- Data
      const burgers = [
        {
          id: "divine-truffle",
          name: "Divine Truffle",
          description: "Angus premium, crema de trufa, rúcula y brioche tostado.",
          price: 16.9,
          grams: 320,
          img: "https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=1600&q=80",
          ingredients: ["Pan brioche", "Angus 180g", "Gruyère", "Crema de trufa", "Rúcula", "Alioli Divine"],
          nutrition: { kcal: 780, proteina_g: 42, carbos_g: 48, grasa_g: 46, sodio_mg: 980 },
        },
        {
          id: "golden-smash",
          name: "Golden Smash",
          description: "Doble smash, cheddar añejado, cebolla caramelizada, pepinillos.",
          price: 15.5,
          grams: 340,
          img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=1600&q=80",
          ingredients: ["Potato roll", "Doble smash", "Cheddar añejado", "Cebolla caramelizada", "Pepinillos", "Salsa Divine"],
          nutrition: { kcal: 860, proteina_g: 48, carbos_g: 52, grasa_g: 52, sodio_mg: 1120 },
        },
        {
          id: "noir-pepper",
          name: "Noir Pepper",
          description: "Costra de pimienta, queso azul suave, aros crujientes y demi-glace.",
          price: 17.25,
          grams: 330,
          img: "https://images.unsplash.com/photo-1550317138-10000687a72b?auto=format&fit=crop&w=1600&q=80",
          ingredients: ["Pan sésamo", "Res con pimienta", "Queso azul", "Cebolla crujiente", "Demi-glace", "Lechuga"],
          nutrition: { kcal: 820, proteina_g: 45, carbos_g: 44, grasa_g: 50, sodio_mg: 1040 },
        },
        {
          id: "saffron-wagyu",
          name: "Saffron Wagyu",
          description: "Blend wagyu, alioli de azafrán, tomate confitado y toque dorado.",
          price: 21.9,
          grams: 310,
          img: "https://images.unsplash.com/photo-1551782450-a2132b4ba21d?auto=format&fit=crop&w=1600&q=80",
          ingredients: ["Pan brioche", "Blend wagyu", "Cheddar blanco", "Alioli de azafrán", "Tomate confitado", "Microgreens"],
          nutrition: { kcal: 790, proteina_g: 41, carbos_g: 46, grasa_g: 47, sodio_mg: 960 },
        },
        {
          id: "midnight-umami",
          name: "Midnight Umami",
          description: "Duxelles de hongos, glaze de soya, suizo, ajo rostizado.",
          price: 18.4,
          grams: 335,
          img: "https://images.unsplash.com/photo-1596662951482-0c4ba74a6df6?auto=format&fit=crop&w=1600&q=80",
          ingredients: ["Potato roll", "Carne premium", "Queso suizo", "Duxelles de hongos", "Ajo rostizado", "Glaze de soya"],
          nutrition: { kcal: 805, proteina_g: 44, carbos_g: 50, grasa_g: 48, sodio_mg: 1090 },
        },
        {
          id: "velvet-chicken",
          name: "Velvet Chicken",
          description: "Pollo crispy, glaze miel-oro, ensalada col y final cítrico.",
          price: 14.75,
          grams: 360,
          img: "https://images.unsplash.com/photo-1606755962773-d324e0a13086?auto=format&fit=crop&w=1600&q=80",
          ingredients: ["Pan brioche", "Pollo crispy", "Glaze miel-oro", "Coleslaw", "Pepinillos", "Alioli limón"],
          nutrition: { kcal: 740, proteina_g: 39, carbos_g: 58, grasa_g: 38, sodio_mg: 980 },
        },
      ];

      const desserts = [
        {
          id: "noir-cheesecake",
          name: "Noir Cheesecake",
          description: "Cheesecake sedoso con cacao oscuro y crumble de avellana.",
          price: 9.5,
          img: "https://images.unsplash.com/photo-1541781408260-3c7b8d7a5b61?auto=format&fit=crop&w=1600&q=80",
        },
        {
          id: "gold-mousse",
          name: "Gold Mousse",
          description: "Mousse de vainilla de Madagascar con brillo dorado sutil.",
          price: 10.25,
          img: "https://images.unsplash.com/photo-1601972602237-8c79241e468b?auto=format&fit=crop&w=1600&q=80",
        },
        {
          id: "creme-brulee-tart",
          name: "Tarta Crème Brûlée",
          description: "Caramelo flameado, núcleo de crema y base mantequilla.",
          price: 10.75,
          img: "https://images.unsplash.com/photo-1608198093002-ad4e005484ec?auto=format&fit=crop&w=1600&q=80",
        },
        {
          id: "pistachio-opera",
          name: "Ópera de Pistacho",
          description: "Capas de pistacho con notas de espresso y glaseado satinado.",
          price: 11.5,
          img: "https://images.unsplash.com/photo-1589308078059-be1415eab4c3?auto=format&fit=crop&w=1600&q=80",
        },
      ];

      // ---- UI Components
      function Header({ onNavigate, onOpenCart, cartCount }) {
        return (
          <div className="fixed left-0 top-0 z-40 w-full">
            <div className="mx-auto max-w-6xl px-4 md:px-6">
              <div className="mt-3 rounded-2xl border border-divineLine bg-divinePanel backdrop-blur-xl shadow-divine">
                <div className="grid grid-cols-3 items-center px-4 py-3 md:px-6">
                  <nav className="hidden gap-4 text-xs tracking-[0.22em] text-divineCream/80 md:flex">
                    <button onClick={() => onNavigate("burgers")} className="hover:text-divineGold transition">HAMBURGUESAS</button>
                    <button onClick={() => onNavigate("desserts")} className="hover:text-divineGold transition">POSTRES</button>
                    <button onClick={() => onNavigate("yogurt")} className="hover:text-divineGold transition">YOGURT</button>
                    <button onClick={() => onNavigate("atelier")} className="hover:text-divineGold transition">ATELIER</button>
                  </nav>

                  <div className="flex items-center justify-center select-none">
                    <div className="text-center">
                      <div className="text-xs tracking-luxe text-divineGold/95">DIVINE</div>
                      <div className="text-[10px] tracking-[0.35em] text-divineCream/55">GOURMET</div>
                    </div>
                  </div>

                  <div className="flex items-center justify-end gap-2">
                    <button
                      onClick={onOpenCart}
                      className="relative rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/85 hover:border-divineGold/60 hover:text-divineGold transition"
                    >
                      CARRITO
                      {cartCount > 0 && (
                        <span className="ml-2 inline-flex min-w-5 items-center justify-center rounded-full bg-divineGold px-1.5 py-0.5 text-[10px] font-semibold text-black">
                          {cartCount}
                        </span>
                      )}
                    </button>

                    <div className="flex md:hidden">
                      <button
                        onClick={() => onNavigate("burgers")}
                        className="rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/85"
                      >
                        MENÚ
                      </button>
                    </div>
                  </div>
                </div>

                <div className="flex md:hidden gap-2 px-4 pb-3">
                  {[
                    ["HAMB", "burgers"],
                    ["POSTRES", "desserts"],
                    ["YOGURT", "yogurt"],
                    ["ATELIER", "atelier"],
                  ].map(([label, key]) => (
                    <button
                      key={key}
                      onClick={() => onNavigate(key)}
                      className="flex-1 rounded-xl border border-divineLine bg-black/20 py-2 text-[11px] tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition"
                    >
                      {label}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>
        );
      }

      function SectionShell({ eyebrow, title, subtitle, children }) {
        return (
          <div className="mb-12 md:mb-16">
            <motion.div
              initial={{ opacity: 0, y: 18 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ amount: 0.25, once: true }}
              transition={{ duration: 0.7, ease: [0.2, 0.8, 0.2, 1] }}
              className="mb-5 md:mb-7"
            >
              <div className="mb-2 text-xs tracking-[0.35em] text-divineGold/90">{eyebrow}</div>
              <h2 className="text-2xl font-semibold md:text-4xl">{title}</h2>
              <p className="mt-2 max-w-2xl text-sm text-divineCream/70 md:text-base">{subtitle}</p>
            </motion.div>
            {children}
          </div>
        );
      }

      function ProductCard({ product, badge, onClick, onAdd }) {
        return (
          <motion.div
            whileHover={{ y: -4 }}
            transition={{ type: "spring", stiffness: 260, damping: 22 }}
            className="group overflow-hidden rounded-2xl border border-divineLine bg-divinePanel shadow-divine"
          >
            <button onClick={onClick} className="block w-full text-left">
              <div className="relative aspect-[4/3] overflow-hidden">
                <img
                  src={product.img}
                  alt={product.name}
                  className="h-full w-full object-cover transition duration-700 group-hover:scale-[1.05]"
                  loading="lazy"
                />
                <div className="absolute left-3 top-3 rounded-full border border-divineLine bg-black/30 px-3 py-1 text-[10px] tracking-[0.28em] text-divineCream/80 backdrop-blur">
                  {badge}
                </div>
              </div>

              <div className="p-4">
                <div className="flex items-start justify-between gap-3">
                  <div>
                    <div className="text-base font-semibold">{product.name}</div>
                    <div className="mt-1 text-sm text-divineCream/70 line-clamp-2">{product.description}</div>
                  </div>
                  <div className="text-sm font-semibold text-divineGold">{money(product.price)}</div>
                </div>

                <div className="mt-4 flex items-center justify-between gap-3">
                  <span className="text-xs tracking-[0.22em] text-divineCream/55">DIVINE</span>
                  <button
                    onClick={(e) => { e.preventDefault(); e.stopPropagation(); onAdd?.(); }}
                    className="rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/80 hover:border-divineGold/60 hover:text-divineGold transition"
                  >
                    AÑADIR
                  </button>
                </div>
              </div>
            </button>
          </motion.div>
        );
      }

      // ---- 3D Viewer (sin OrbitControls, no se rompe en Pages)
      function ThreeBurgerViewer() {
        const mountRef = useRef(null);
        const burgerRef = useRef(null);
        const cameraRef = useRef(null);
        const rendererRef = useRef(null);
        const rafRef = useRef(null);

        const yawRef = useRef(0);
        const pitchRef = useRef(0);
        const draggingRef = useRef(false);
        const lastRef = useRef({ x: 0, y: 0 });

        const [autoRotate, setAutoRotate] = useState(true);
        const [roll, setRoll] = useState(0);

        useEffect(() => {
          const mount = mountRef.current;
          if (!mount) return;

          // tamaño inicial (robusto)
          const getSize = () => {
            const r = mount.getBoundingClientRect();
            const w = Math.max(1, Math.floor(r.width));
            const h = Math.max(1, Math.floor(r.height));
            return { w, h };
          };

          const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
          renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
          const { w, h } = getSize();
          renderer.setSize(w, h);
          renderer.shadowMap.enabled = true;
          renderer.shadowMap.type = THREE.PCFSoftShadowMap;

          renderer.domElement.style.width = "100%";
          renderer.domElement.style.height = "100%";
          renderer.domElement.style.display = "block";
          renderer.domElement.style.touchAction = "none";

          mount.appendChild(renderer.domElement);
          rendererRef.current = renderer;

          const scene = new THREE.Scene();
          scene.fog = new THREE.Fog(0x0a0a0f, 9, 18);

          const camera = new THREE.PerspectiveCamera(45, w / h, 0.1, 100);
          camera.position.set(0, 1.25, 3.4);
          cameraRef.current = camera;

          // luces premium
          scene.add(new THREE.HemisphereLight(0xf5efe6, 0x07070a, 0.55));

          const key = new THREE.DirectionalLight(0xffffff, 1.1);
          key.position.set(3.5, 5.2, 2.8);
          key.castShadow = true;
          key.shadow.mapSize.set(1024, 1024);
          key.shadow.camera.near = 0.5;
          key.shadow.camera.far = 20;
          key.shadow.camera.left = -4;
          key.shadow.camera.right = 4;
          key.shadow.camera.top = 4;
          key.shadow.camera.bottom = -4;
          scene.add(key);

          const rim = new THREE.DirectionalLight(0xc7a35c, 0.65);
          rim.position.set(-4.5, 2.0, -2.5);
          scene.add(rim);

          // suelo
          const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(30, 30),
            new THREE.ShadowMaterial({ opacity: 0.22 })
          );
          ground.rotation.x = -Math.PI / 2;
          ground.position.y = -1.1;
          ground.receiveShadow = true;
          scene.add(ground);

          // burger placeholder
          const burger = new THREE.Group();
          burger.position.set(0, -0.35, 0);

          const matBun = new THREE.MeshStandardMaterial({ color: 0xc7a35c, roughness: 0.55, metalness: 0.08 });
          const matMeat = new THREE.MeshStandardMaterial({ color: 0x3b2016, roughness: 0.85, metalness: 0.02 });
          const matCheese = new THREE.MeshStandardMaterial({ color: 0xf2c24f, roughness: 0.4, metalness: 0.05 });
          const matLettuce = new THREE.MeshStandardMaterial({ color: 0x3f8f5a, roughness: 0.75 });
          const matTomato = new THREE.MeshStandardMaterial({ color: 0xb33b2e, roughness: 0.65 });

          function layer(geo, mat, y) {
            const m = new THREE.Mesh(geo, mat);
            m.position.y = y;
            m.castShadow = true;
            m.receiveShadow = true;
            burger.add(m);
            return m;
          }

          layer(new THREE.CylinderGeometry(0.92, 0.86, 0.35, 56), matBun, 1.0);
          layer(new THREE.CylinderGeometry(0.98, 0.98, 0.08, 56), matCheese, 0.72);
          layer(new THREE.CylinderGeometry(1.0, 1.0, 0.26, 56), matMeat, 0.53);
          layer(new THREE.CylinderGeometry(1.02, 1.02, 0.07, 56), matCheese, 0.32);

          const lettuce = layer(new THREE.TorusGeometry(0.78, 0.12, 14, 80), matLettuce, 0.16);
          lettuce.rotation.x = Math.PI / 2;

          for (let i = 0; i < 3; i++) {
            const t = new THREE.Mesh(new THREE.CylinderGeometry(0.28, 0.28, 0.06, 40), matTomato);
            t.position.set(Math.cos(i * 2.2) * 0.45, 0.12, Math.sin(i * 2.2) * 0.45);
            t.rotation.x = Math.PI / 2;
            t.castShadow = true;
            burger.add(t);
          }

          layer(new THREE.CylinderGeometry(0.9, 0.96, 0.22, 56), matBun, -0.02);

          scene.add(burger);
          burgerRef.current = burger;

          // Controles propios: drag para rotar + wheel para zoom
          const el = renderer.domElement;

          const onDown = (e) => {
            draggingRef.current = true;
            lastRef.current = { x: e.clientX, y: e.clientY };
            el.setPointerCapture?.(e.pointerId);
          };

          const onMove = (e) => {
            if (!draggingRef.current) return;
            const dx = e.clientX - lastRef.current.x;
            const dy = e.clientY - lastRef.current.y;
            lastRef.current = { x: e.clientX, y: e.clientY };

            yawRef.current += dx * 0.007;
            pitchRef.current += dy * 0.007;
            pitchRef.current = Math.max(-1.15, Math.min(1.15, pitchRef.current));
          };

          const onUp = () => { draggingRef.current = false; };

          const onWheel = (e) => {
            e.preventDefault();
            const cam = cameraRef.current;
            if (!cam) return;
            cam.position.z += e.deltaY * 0.002;
            cam.position.z = Math.max(2.2, Math.min(5.2, cam.position.z));
          };

          el.addEventListener("pointerdown", onDown);
          el.addEventListener("pointermove", onMove);
          window.addEventListener("pointerup", onUp);
          el.addEventListener("wheel", onWheel, { passive: false });

          const onResize = () => {
            const { w: nw, h: nh } = getSize();
            camera.aspect = nw / nh;
            camera.updateProjectionMatrix();
            renderer.setSize(nw, nh);
          };
          window.addEventListener("resize", onResize);

          const animate = () => {
            rafRef.current = requestAnimationFrame(animate);
            if (burgerRef.current) {
              if (autoRotate && !draggingRef.current) yawRef.current += 0.0045;
              burgerRef.current.rotation.y = yawRef.current;
              burgerRef.current.rotation.x = pitchRef.current;
              burgerRef.current.rotation.z = roll;
            }
            renderer.render(scene, camera);
          };
          animate();

          return () => {
            window.removeEventListener("resize", onResize);
            cancelAnimationFrame(rafRef.current);

            el.removeEventListener("pointerdown", onDown);
            el.removeEventListener("pointermove", onMove);
            window.removeEventListener("pointerup", onUp);
            el.removeEventListener("wheel", onWheel);

            renderer.dispose();
            mount.removeChild(renderer.domElement);
          };
        }, [autoRotate, roll]);

        return (
          <div className="relative h-full w-full">
            <div className="absolute left-4 top-4 z-10 rounded-full border border-divineLine bg-black/30 px-3 py-1 text-[10px] tracking-[0.28em] text-divineCream/80 backdrop-blur">
              VISOR 360°
            </div>

            <div className="absolute bottom-4 left-4 right-4 z-10 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
              <div className="flex gap-2">
                <button
                  onClick={() => setAutoRotate((s) => !s)}
                  className="rounded-xl border border-divineLine bg-black/30 px-3 py-2 text-[11px] tracking-[0.22em] text-divineCream/75 backdrop-blur hover:text-divineGold transition"
                >
                  {autoRotate ? "PAUSAR" : "AUTO"}
                </button>
                <button
                  onClick={() => { yawRef.current = 0; pitchRef.current = 0; setRoll(0); }}
                  className="rounded-xl border border-divineLine bg-black/30 px-3 py-2 text-[11px] tracking-[0.22em] text-divineCream/75 backdrop-blur hover:text-divineGold transition"
                >
                  REINICIAR
                </button>
                <div className="hidden md:flex rounded-xl border border-divineLine bg-black/30 px-3 py-2 text-[11px] tracking-[0.22em] text-divineCream/55 backdrop-blur">
                  ARRASTRA • ZOOM
                </div>
              </div>

              <div className="flex items-center gap-3 rounded-2xl border border-divineLine bg-black/30 px-3 py-2 backdrop-blur">
                <div className="text-[10px] tracking-[0.28em] text-divineCream/60">GIRO Z</div>
                <input
                  type="range"
                  min={-3.1416}
                  max={3.1416}
                  step={0.01}
                  value={roll}
                  onChange={(e) => setRoll(parseFloat(e.target.value))}
                  className="w-44 accent-[#C7A35C]"
                />
              </div>
            </div>

            <!-- altura explícita para evitar canvas 0px -->
            <div ref={mountRef} className="h-[340px] md:h-[420px] lg:h-[560px] w-full bg-gradient-to-b from-black/0 to-black/35"></div>
          </div>
        );
      }

      function ProductModal({ product, onClose, onAdd }) {
        useLockBodyScroll(true);
        useEscape(onClose, true);

        const [showIngredients, setShowIngredients] = useState(true);

        return (
          <motion.div
            className="fixed inset-0 z-50"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            aria-modal="true"
            role="dialog"
          >
            <button className="absolute inset-0 bg-black/70" onClick={onClose} aria-label="Cerrar" />

            <motion.div
              initial={{ y: 26, opacity: 0, scale: 0.98 }}
              animate={{ y: 0, opacity: 1, scale: 1 }}
              exit={{ y: 18, opacity: 0, scale: 0.98 }}
              transition={{ duration: 0.35, ease: [0.2, 0.8, 0.2, 1] }}
              className="absolute left-1/2 top-1/2 w-[92vw] max-w-5xl -translate-x-1/2 -translate-y-1/2 overflow-hidden rounded-3xl border border-divineLine bg-[#0A0A0F] shadow-divine"
            >
              <div className="grid grid-cols-1 lg:grid-cols-2">
                <div className="relative">
                  <ThreeBurgerViewer />
                </div>

                <div className="p-5 lg:p-7">
                  <div className="flex items-start justify-between gap-4">
                    <div>
                      <div className="text-xs tracking-[0.35em] text-divineGold/90">THE DIVINE COLLECTION</div>
                      <h3 className="mt-2 text-2xl font-semibold">{product.name}</h3>
                      <p className="mt-2 text-sm text-divineCream/70">{product.description}</p>
                    </div>

                    <button
                      onClick={onClose}
                      className="rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition"
                    >
                      CERRAR
                    </button>
                  </div>

                  <div className="mt-5 flex flex-wrap items-center gap-3">
                    <span className="rounded-full border border-divineLine bg-divinePanel px-3 py-1 text-xs text-divineCream/75">
                      Peso: <span className="text-divineCream">{product.grams}g</span>
                    </span>
                    <span className="rounded-full border border-divineLine bg-divinePanel px-3 py-1 text-xs text-divineCream/75">
                      Precio: <span className="text-divineGold font-semibold">{money(product.price)}</span>
                    </span>

                    <button
                      onClick={onAdd}
                      className="ml-auto rounded-xl border border-divineGold/40 bg-divineGold px-4 py-2 text-xs tracking-[0.22em] font-semibold text-black hover:brightness-110 transition"
                    >
                      AÑADIR AL CARRITO
                    </button>
                  </div>

                  <div className="mt-6">
                    <button
                      onClick={() => setShowIngredients((s) => !s)}
                      className="flex w-full items-center justify-between rounded-2xl border border-divineLine bg-divinePanel px-4 py-3 text-left"
                    >
                      <div>
                        <div className="text-xs tracking-[0.28em] text-divineCream/60">DETALLES</div>
                        <div className="mt-1 text-sm font-semibold">Ingredientes</div>
                      </div>
                      <span className="text-xs tracking-[0.22em] text-divineGold">
                        {showIngredients ? "OCULTAR" : "MOSTRAR"}
                      </span>
                    </button>

                    <AnimatePresence initial={false}>
                      {showIngredients && (
                        <motion.div
                          initial={{ height: 0, opacity: 0 }}
                          animate={{ height: "auto", opacity: 1 }}
                          exit={{ height: 0, opacity: 0 }}
                          transition={{ duration: 0.25 }}
                          className="overflow-hidden"
                        >
                          <ul className="mt-3 space-y-2 rounded-2xl border border-divineLine bg-black/20 p-4 text-sm text-divineCream/75">
                            {product.ingredients?.map((ing) => (
                              <li key={ing} className="flex items-center justify-between">
                                <span>{ing}</span>
                                <span className="text-divineGold/60">•</span>
                              </li>
                            ))}
                          </ul>
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>

                  <div className="mt-6 rounded-2xl border border-divineLine bg-black/20 p-4">
                    <div className="text-xs tracking-[0.28em] text-divineCream/60">NUTRICIÓN</div>
                    <div className="mt-3 grid grid-cols-2 gap-3 text-sm">
                      {Object.entries(product.nutrition || {}).map(([k, v]) => (
                        <div key={k} className="flex items-center justify-between rounded-xl border border-divineLine bg-divinePanel px-3 py-2">
                          <span className="text-divineCream/70">{String(k).toUpperCase()}</span>
                          <span className="font-semibold text-divineCream">{v}</span>
                        </div>
                      ))}
                    </div>
                    <p className="mt-3 text-xs text-divineCream/50">Valores aproximados (placeholder).</p>
                  </div>
                </div>
              </div>
            </motion.div>
          </motion.div>
        );
      }

      function CartButton({ cartCount, onClick }) {
        return (
          <button
            onClick={onClick}
            className="fixed bottom-6 right-6 z-40 rounded-2xl border border-divineLine bg-divinePanel px-4 py-3 shadow-divine backdrop-blur hover:border-divineGold/60 transition"
            aria-label="Abrir carrito"
          >
            <div className="flex items-center gap-3">
              <div className="text-xs tracking-[0.28em] text-divineCream/75">CARRITO</div>
              <div className="rounded-full bg-divineGold px-2 py-1 text-xs font-semibold text-black">{cartCount}</div>
            </div>
          </button>
        );
      }

      function CartDrawer({ items, total, onClose, onQty }) {
        useLockBodyScroll(true);
        useEscape(onClose, true);

        return (
          <motion.div className="fixed inset-0 z-50" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} aria-modal="true" role="dialog">
            <button className="absolute inset-0 bg-black/70" onClick={onClose} aria-label="Cerrar carrito" />
            <motion.aside
              initial={{ x: 24, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
              exit={{ x: 24, opacity: 0 }}
              transition={{ duration: 0.28, ease: [0.2, 0.8, 0.2, 1] }}
              className="absolute right-0 top-0 h-full w-[92vw] max-w-md border-l border-divineLine bg-[#0A0A0F] p-5 shadow-divine"
            >
              <div className="flex items-start justify-between">
                <div>
                  <div className="text-xs tracking-[0.35em] text-divineGold/90">DIVINE</div>
                  <h3 className="mt-2 text-xl font-semibold">Carrito</h3>
                  <p className="mt-1 text-sm text-divineCream/60">Revisa y ajusta cantidades.</p>
                </div>
                <button onClick={onClose} className="rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition">
                  CERRAR
                </button>
              </div>

              <div className="mt-6 space-y-3">
                {items.length === 0 ? (
                  <div className="rounded-2xl border border-divineLine bg-divinePanel p-4 text-sm text-divineCream/70">Tu carrito está vacío.</div>
                ) : (
                  items.map((it) => (
                    <div key={it.id} className="rounded-2xl border border-divineLine bg-divinePanel p-4">
                      <div className="flex items-start justify-between gap-3">
                        <div>
                          <div className="font-semibold">{it.name}</div>
                          <div className="mt-1 text-sm text-divineCream/70">{money(it.price)}</div>

                          {it.meta && (
                            <div className="mt-2 text-xs text-divineCream/55">
                              {Object.entries(it.meta).map(([k, v]) => (
                                <div key={k}>
                                  <span className="text-divineGold/80">{k}:</span>{" "}
                                  <span>{Array.isArray(v) ? v.join(", ") : String(v)}</span>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="text-sm font-semibold text-divineGold">{money(it.price * it.qty)}</div>
                      </div>

                      <div className="mt-3 flex items-center gap-2">
                        <button className="rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/75" onClick={() => onQty(it.id, it.qty - 1)}>−</button>
                        <div className="min-w-10 text-center text-sm">{it.qty}</div>
                        <button className="rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/75" onClick={() => onQty(it.id, it.qty + 1)}>+</button>

                        <button className="ml-auto rounded-xl border border-divineLine bg-black/20 px-3 py-2 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition" onClick={() => onQty(it.id, 0)}>
                          ELIMINAR
                        </button>
                      </div>
                    </div>
                  ))
                )}
              </div>

              <div className="mt-6 rounded-2xl border border-divineLine bg-black/20 p-4">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-divineCream/70">Total</span>
                  <span className="text-lg font-semibold text-divineGold">{money(total)}</span>
                </div>
                <button className="mt-4 w-full rounded-2xl border border-divineGold/40 bg-divineGold py-3 text-xs tracking-[0.22em] font-semibold text-black hover:brightness-110 transition disabled:opacity-60" disabled={items.length === 0}>
                  PAGAR (placeholder)
                </button>
              </div>
            </motion.aside>
          </motion.div>
        );
      }

      // ---- Builders (Burger + Yogurt) (en español)
      const BURGER_OPTIONS = {
        pan: [
          { id: "brioche", label: "Brioche", price: 1.75 },
          { id: "potato", label: "Potato Roll", price: 1.5 },
          { id: "sesame", label: "Sésamo", price: 1.25 },
        ],
        proteina: [
          { id: "angus", label: "Angus 180g", price: 7.25 },
          { id: "smash-double", label: "Doble Smash", price: 7.9 },
          { id: "chicken", label: "Pollo Crispy", price: 6.9 },
          { id: "plant", label: "Plant-based", price: 7.1 },
        ],
        queso: [
          { id: "cheddar", label: "Cheddar Añejo", price: 1.35 },
          { id: "gruyere", label: "Gruyère", price: 1.75 },
          { id: "blue", label: "Azul Suave", price: 1.95 },
          { id: "none", label: "Sin queso", price: 0 },
        ],
        toppings: [
          { id: "trufa", label: "Trufa", price: 2.4 },
          { id: "cebolla", label: "Cebolla caramelizada", price: 1.1 },
          { id: "pepinillos", label: "Pepinillos", price: 0.7 },
          { id: "bacon", label: "Bacon premium", price: 2.0 },
          { id: "rucula", label: "Rúcula", price: 0.85 },
          { id: "salsa", label: "Salsa Divine", price: 1.0 },
        ],
      };
      const BURGER_BASE = 2.95;

      function SummaryRow({ label, value }) {
        return (
          <div className="flex items-center justify-between rounded-2xl border border-divineLine bg-divinePanel px-4 py-3">
            <span className="text-divineCream/70">{label}</span>
            <span className="font-semibold text-divineCream">{value}</span>
          </div>
        );
      }

      function OptionGrid({ title, options, value, onChange, single }) {
        return (
          <div>
            <div className="mb-3 text-xs tracking-[0.28em] text-divineCream/55">{title.toUpperCase()}</div>
            <div className="grid gap-3 sm:grid-cols-2">
              {options.map((opt) => {
                const active = single ? value === opt.id : (value || []).includes(opt.id);
                return (
                  <button
                    key={opt.id}
                    onClick={() => onChange(opt.id)}
                    className={[
                      "rounded-2xl border p-4 text-left transition",
                      active ? "border-divineGold/60 bg-black/35" : "border-divineLine bg-black/20 hover:border-divineGold/40",
                    ].join(" ")}
                  >
                    <div className="flex items-start justify-between gap-3">
                      <div>
                        <div className="font-semibold">{opt.label}</div>
                        <div className="mt-1 text-sm text-divineCream/65">+ {money(opt.price)}</div>
                      </div>
                      <div className={["mt-1 h-3 w-3 rounded-full border", active ? "border-divineGold bg-divineGold" : "border-divineLine bg-transparent"].join(" ")} />
                    </div>
                  </button>
                );
              })}
            </div>
          </div>
        );
      }

      function BurgerBuilder({ onAddToCart }) {
        const [step, setStep] = useState(0);
        const [pan, setPan] = useState(null);
        const [proteina, setProteina] = useState(null);
        const [queso, setQueso] = useState("none");
        const [toppings, setToppings] = useState([]);

        const valido = useMemo(() => !!pan && !!proteina && !!queso, [pan, proteina, queso]);

        const price = useMemo(() => {
          const panP = BURGER_OPTIONS.pan.find((x) => x.id === pan)?.price ?? 0;
          const proP = BURGER_OPTIONS.proteina.find((x) => x.id === proteina)?.price ?? 0;
          const queP = BURGER_OPTIONS.queso.find((x) => x.id === queso)?.price ?? 0;
          const topP = toppings.reduce((acc, id) => acc + (BURGER_OPTIONS.toppings.find((x) => x.id === id)?.price ?? 0), 0);
          return BURGER_BASE + panP + proP + queP + topP;
        }, [pan, proteina, queso, toppings]);

        const resumen = useMemo(() => {
          const panL = BURGER_OPTIONS.pan.find((x) => x.id === pan)?.label;
          const proL = BURGER_OPTIONS.proteina.find((x) => x.id === proteina)?.label;
          const queL = BURGER_OPTIONS.queso.find((x) => x.id === queso)?.label;
          const topL = toppings.map((id) => BURGER_OPTIONS.toppings.find((x) => x.id === id)?.label).filter(Boolean);
          return { panL, proL, queL, topL };
        }, [pan, proteina, queso, toppings]);

        function toggleTopping(id) {
          setToppings((prev) => (prev.includes(id) ? prev.filter((t) => t !== id) : [...prev, id]));
        }

        function armar() {
          if (!valido) return;
          const id = `custom-burger:${pan}:${proteina}:${queso}:${toppings.slice().sort().join(",")}`;
          const meta = { pan: resumen.panL, proteina: resumen.proL, queso: resumen.queL, toppings: resumen.topL };
          onAddToCart?.({ id, name: "Burger Divine (Personalizada)", price, meta });
          setStep(0); setPan(null); setProteina(null); setQueso("none"); setToppings([]);
        }

        return (
          <div className="grid gap-4 lg:grid-cols-[1.3fr_0.7fr]">
            <div className="rounded-3xl border border-divineLine bg-divinePanel p-4 md:p-6 shadow-divine">
              <div className="flex flex-wrap items-center justify-between gap-3">
                <div>
                  <div className="text-xs tracking-[0.35em] text-divineGold/90">PASO A PASO</div>
                  <h3 className="mt-2 text-xl font-semibold md:text-2xl">Arma tu Hamburguesa</h3>
                  <p className="mt-1 text-sm text-divineCream/65">El precio se actualiza en tiempo real.</p>
                </div>

                <div className="rounded-2xl border border-divineLine bg-black/20 px-4 py-3">
                  <div className="text-[10px] tracking-[0.28em] text-divineCream/55">PRECIO</div>
                  <div className="mt-1 text-lg font-semibold text-divineGold">{money(price)}</div>
                </div>
              </div>

              <div className="mt-5 grid grid-cols-4 gap-2">
                {["PAN", "PROTEÍNA", "QUESO", "TOPPINGS"].map((label, i) => (
                  <button
                    key={label}
                    onClick={() => setStep(i)}
                    className={[
                      "rounded-2xl border px-3 py-2 text-[11px] tracking-[0.22em] transition",
                      step === i ? "border-divineGold/60 bg-black/35 text-divineGold" : "border-divineLine bg-black/20 text-divineCream/70 hover:text-divineGold",
                    ].join(" ")}
                  >
                    {label}
                  </button>
                ))}
              </div>

              <motion.div key={step} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.25 }} className="mt-5">
                {step === 0 && <OptionGrid title="Elige tu pan" options={BURGER_OPTIONS.pan} value={pan} onChange={setPan} single />}
                {step === 1 && <OptionGrid title="Elige tu proteína" options={BURGER_OPTIONS.proteina} value={proteina} onChange={setProteina} single />}
                {step === 2 && <OptionGrid title="Elige tu queso" options={BURGER_OPTIONS.queso} value={queso} onChange={setQueso} single />}
                {step === 3 && <OptionGrid title="Toppings (multi)" options={BURGER_OPTIONS.toppings} value={toppings} onChange={toggleTopping} single={false} />}
              </motion.div>

              <div className="mt-6 flex flex-wrap items-center gap-3">
                <button onClick={() => setStep((s) => Math.max(0, s - 1))} className="rounded-2xl border border-divineLine bg-black/20 px-4 py-3 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition">
                  ATRÁS
                </button>

                <button onClick={() => setStep((s) => Math.min(3, s + 1))} className="rounded-2xl border border-divineLine bg-black/20 px-4 py-3 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition">
                  SIGUIENTE
                </button>

                <button
                  onClick={armar}
                  disabled={!valido}
                  className="ml-auto rounded-2xl border border-divineGold/40 bg-divineGold px-5 py-3 text-xs tracking-[0.22em] font-semibold text-black hover:brightness-110 transition disabled:opacity-60 disabled:hover:brightness-100"
                >
                  ARMAR HAMBURGUESA
                </button>
              </div>

              {!valido && (
                <p className="mt-3 text-xs text-divineCream/55">
                  Completa <span className="text-divineGold">pan</span>, <span className="text-divineGold">proteína</span> y <span className="text-divineGold">queso</span>.
                </p>
              )}
            </div>

            <div className="rounded-3xl border border-divineLine bg-black/20 p-4 md:p-6 shadow-divine">
              <div className="text-xs tracking-[0.35em] text-divineGold/90">RESUMEN</div>
              <h4 className="mt-2 text-lg font-semibold">Tu orden</h4>

              <div className="mt-4 space-y-3 text-sm">
                <SummaryRow label="Pan" value={resumen.panL || "—"} />
                <SummaryRow label="Proteína" value={resumen.proL || "—"} />
                <SummaryRow label="Queso" value={resumen.queL || "—"} />

                <div className="rounded-2xl border border-divineLine bg-divinePanel p-4">
                  <div className="flex items-center justify-between">
                    <span className="text-divineCream/70">Toppings</span>
                    <span className="text-xs tracking-[0.22em] text-divineCream/55">{resumen.topL?.length || 0}</span>
                  </div>
                  <div className="mt-3 flex flex-wrap gap-2">
                    {resumen.topL?.length ? (
                      resumen.topL.map((t) => (
                        <span key={t} className="rounded-full border border-divineLine bg-black/20 px-3 py-1 text-xs text-divineCream/75">{t}</span>
                      ))
                    ) : (
                      <span className="text-divineCream/55">—</span>
                    )}
                  </div>
                </div>

                <div className="flex items-center justify-between rounded-2xl border border-divineLine bg-divinePanel px-4 py-3">
                  <span className="text-divineCream/70">Total estimado</span>
                  <span className="font-semibold text-divineGold">{money(price)}</span>
                </div>
              </div>
            </div>
          </div>
        );
      }

      const YOGURT_OPTIONS = {
        tamano: [
          { id: "mini", label: "Mini", price: 4.95 },
          { id: "clasico", label: "Clásico", price: 6.5 },
          { id: "grand", label: "Grand", price: 7.95 },
        ],
        sabor: [
          { id: "griego", label: "Griego Clásico", price: 0 },
          { id: "vainilla", label: "Vainilla Bean", price: 0.5 },
          { id: "fresa", label: "Fresa Rose", price: 0.75 },
        ],
        salsas: [
          { id: "miel", label: "Miel Gold", price: 0.9 },
          { id: "choco", label: "Chocolate oscuro", price: 1.1 },
          { id: "berries", label: "Coulis de berries", price: 1.0 },
          { id: "caramelo", label: "Caramelo salado", price: 1.1 },
        ],
        crunch: [
          { id: "granola", label: "Granola", price: 0.85 },
          { id: "nibs", label: "Cacao nibs", price: 0.95 },
          { id: "pistacho", label: "Pistacho", price: 1.25 },
          { id: "almendra", label: "Almendra brittle", price: 1.15 },
        ],
        fruta: [
          { id: "blueberries", label: "Blueberries", price: 0.95 },
          { id: "strawberries", label: "Fresas", price: 1.0 },
          { id: "mango", label: "Mango", price: 1.05 },
          { id: "banana", label: "Banana", price: 0.75 },
        ],
        luxe: [
          { id: "sal", label: "Sal en escamas", price: 0.35 },
          { id: "espresso", label: "Polvo de espresso", price: 0.55 },
          { id: "oro", label: "Polvo oro comestible", price: 1.5 },
        ],
      };

      function YogurtMachineBuilder({ onAddToCart }) {
        const [step, setStep] = useState(0);
        const [tamano, setTamano] = useState("clasico");
        const [sabor, setSabor] = useState("griego");
        const [salsas, setSalsas] = useState([]);
        const [crunch, setCrunch] = useState([]);
        const [fruta, setFruta] = useState([]);
        const [luxe, setLuxe] = useState([]);

        const price = useMemo(() => {
          const pick = (id, opts) => (opts.find((x) => x.id === id)?.price ?? 0);
          const sum = (arr, opts) => arr.reduce((acc, id) => acc + (opts.find((x) => x.id === id)?.price ?? 0), 0);

          return (
            pick(tamano, YOGURT_OPTIONS.tamano) +
            pick(sabor, YOGURT_OPTIONS.sabor) +
            sum(salsas, YOGURT_OPTIONS.salsas) +
            sum(crunch, YOGURT_OPTIONS.crunch) +
            sum(fruta, YOGURT_OPTIONS.fruta) +
            sum(luxe, YOGURT_OPTIONS.luxe)
          );
        }, [tamano, sabor, salsas, crunch, fruta, luxe]);

        const resumen = useMemo(() => {
          const label = (id, opts) => opts.find((x) => x.id === id)?.label;
          const labels = (arr, opts) => arr.map((id) => label(id, opts)).filter(Boolean);
          return {
            tamano: label(tamano, YOGURT_OPTIONS.tamano),
            sabor: label(sabor, YOGURT_OPTIONS.sabor),
            salsas: labels(salsas, YOGURT_OPTIONS.salsas),
            crunch: labels(crunch, YOGURT_OPTIONS.crunch),
            fruta: labels(fruta, YOGURT_OPTIONS.fruta),
            luxe: labels(luxe, YOGURT_OPTIONS.luxe),
          };
        }, [tamano, sabor, salsas, crunch, fruta, luxe]);

        function toggle(id, setter) {
          setter((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));
        }

        function addToCart() {
          const id = `yogurt:${tamano}:${sabor}:${[...salsas].sort().join(",")}:${[...crunch].sort().join(",")}:${[...fruta].sort().join(",")}:${[...luxe].sort().join(",")}`;
          onAddToCart?.({ id, name: "Yogurt Griego (Máquina)", price, meta: resumen });

          setStep(0);
          setTamano("clasico");
          setSabor("griego");
          setSalsas([]);
          setCrunch([]);
          setFruta([]);
          setLuxe([]);
        }

        const steps = [
          { label: "TAMAÑO", render: () => <OptionGrid title="Elige tamaño" options={YOGURT_OPTIONS.tamano} value={tamano} onChange={setTamano} single /> },
          { label: "SABOR", render: () => <OptionGrid title="Elige sabor" options={YOGURT_OPTIONS.sabor} value={sabor} onChange={setSabor} single /> },
          { label: "SALSAS", render: () => <OptionGrid title="Salsas (multi)" options={YOGURT_OPTIONS.salsas} value={salsas} onChange={(id)=>toggle(id,setSalsas)} single={false} /> },
          { label: "CRUNCH", render: () => <OptionGrid title="Crunch (multi)" options={YOGURT_OPTIONS.crunch} value={crunch} onChange={(id)=>toggle(id,setCrunch)} single={false} /> },
          { label: "FRUTA", render: () => <OptionGrid title="Fruta (multi)" options={YOGURT_OPTIONS.fruta} value={fruta} onChange={(id)=>toggle(id,setFruta)} single={false} /> },
          { label: "LUXE", render: () => <OptionGrid title="Toques luxe (multi)" options={YOGURT_OPTIONS.luxe} value={luxe} onChange={(id)=>toggle(id,setLuxe)} single={false} /> },
        ];

        return (
          <div className="grid gap-4 lg:grid-cols-[1.3fr_0.7fr]">
            <div className="rounded-3xl border border-divineLine bg-divinePanel p-4 md:p-6 shadow-divine">
              <div className="flex flex-wrap items-center justify-between gap-3">
                <div>
                  <div className="text-xs tracking-[0.35em] text-divineGold/90">MÁQUINA</div>
                  <h3 className="mt-2 text-xl font-semibold md:text-2xl">Yogurt Griego</h3>
                  <p className="mt-1 text-sm text-divineCream/65">Selecciona toppings con precio en vivo.</p>
                </div>

                <div className="rounded-2xl border border-divineLine bg-black/20 px-4 py-3">
                  <div className="text-[10px] tracking-[0.28em] text-divineCream/55">PRECIO</div>
                  <div className="mt-1 text-lg font-semibold text-divineGold">{money(price)}</div>
                </div>
              </div>

              <div className="mt-5 grid grid-cols-3 gap-2 md:grid-cols-6">
                {steps.map((s, i) => (
                  <button
                    key={s.label}
                    onClick={() => setStep(i)}
                    className={[
                      "rounded-2xl border px-3 py-2 text-[11px] tracking-[0.22em] transition",
                      step === i ? "border-divineGold/60 bg-black/35 text-divineGold" : "border-divineLine bg-black/20 text-divineCream/70 hover:text-divineGold",
                    ].join(" ")}
                  >
                    {s.label}
                  </button>
                ))}
              </div>

              <motion.div key={step} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.25 }} className="mt-5">
                {steps[step].render()}
              </motion.div>

              <div className="mt-6 flex flex-wrap items-center gap-3">
                <button onClick={() => setStep((s) => Math.max(0, s - 1))} className="rounded-2xl border border-divineLine bg-black/20 px-4 py-3 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition">
                  ATRÁS
                </button>

                <button onClick={() => setStep((s) => Math.min(steps.length - 1, s + 1))} className="rounded-2xl border border-divineLine bg-black/20 px-4 py-3 text-xs tracking-[0.22em] text-divineCream/75 hover:text-divineGold transition">
                  SIGUIENTE
                </button>

                <button onClick={addToCart} className="ml-auto rounded-2xl border border-divineGold/40 bg-divineGold px-5 py-3 text-xs tracking-[0.22em] font-semibold text-black hover:brightness-110 transition">
                  AÑADIR YOGURT
                </button>
              </div>
            </div>

            <div className="rounded-3xl border border-divineLine bg-black/20 p-4 md:p-6 shadow-divine">
              <div className="text-xs tracking-[0.35em] text-divineGold/90">RESUMEN</div>
              <h4 className="mt-2 text-lg font-semibold">Tu yogurt</h4>

              <div className="mt-4 space-y-3 text-sm">
                <SummaryRow label="Tamaño" value={resumen.tamano || "—"} />
                <SummaryRow label="Sabor" value={resumen.sabor || "—"} />

                {[
                  ["Salsas", resumen.salsas],
                  ["Crunch", resumen.crunch],
                  ["Fruta", resumen.fruta],
                  ["Luxe", resumen.luxe],
                ].map(([label, arr]) => (
                  <div key={label} className="rounded-2xl border border-divineLine bg-divinePanel p-4">
                    <div className="flex items-center justify-between">
                      <span className="text-divineCream/70">{label}</span>
                      <span className="text-xs tracking-[0.22em] text-divineCream/55">{arr?.length || 0}</span>
                    </div>
                    <div className="mt-3 flex flex-wrap gap-2">
                      {arr?.length ? (
                        arr.map((t) => (
                          <span key={t} className="rounded-full border border-divineLine bg-black/20 px-3 py-1 text-xs text-divineCream/75">{t}</span>
                        ))
                      ) : (
                        <span className="text-divineCream/55">—</span>
                      )}
                    </div>
                  </div>
                ))}

                <div className="flex items-center justify-between rounded-2xl border border-divineLine bg-divinePanel px-4 py-3">
                  <span className="text-divineCream/70">Total estimado</span>
                  <span className="font-semibold text-divineGold">{money(price)}</span>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // ---- App
      function App() {
        const refs = {
          burgers: useRef(null),
          desserts: useRef(null),
          yogurt: useRef(null),
          atelier: useRef(null),
        };

        const [activeBurger, setActiveBurger] = useState(null);
        const [cartOpen, setCartOpen] = useState(false);
        const [cartItems, setCartItems] = useState([]);

        const cartCount = useMemo(() => cartItems.reduce((acc, it) => acc + it.qty, 0), [cartItems]);
        const cartTotal = useMemo(() => cartItems.reduce((acc, it) => acc + it.price * it.qty, 0), [cartItems]);

        function scrollTo(key) {
          refs[key]?.current?.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        function addToCart(item) {
          setCartItems((prev) => {
            const idx = prev.findIndex((p) => p.id === item.id);
            if (idx >= 0) {
              const copy = [...prev];
              copy[idx] = { ...copy[idx], qty: copy[idx].qty + 1 };
              return copy;
            }
            return [...prev, { ...item, qty: 1 }];
          });
        }

        function updateQty(id, qty) {
          setCartItems((prev) => prev.map((p) => (p.id === id ? { ...p, qty } : p)).filter((p) => p.qty > 0));
        }

        return (
          <div className="min-h-screen">
            <Header onNavigate={scrollTo} onOpenCart={() => setCartOpen(true)} cartCount={cartCount} />

            <main className="mx-auto max-w-6xl px-4 pb-24 pt-24 md:px-6">
              <motion.section
                initial={{ opacity: 0, y: 14 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.7, ease: [0.2, 0.8, 0.2, 1] }}
                className="mb-10 md:mb-14"
              >
                <p className="mb-3 text-xs tracking-[0.35em] text-divineGold/90">DIVINE • GOURMET BAR</p>
                <h1 className="text-3xl font-semibold leading-tight md:text-5xl">
                  Hamburguesas, postres y yogurt griego con estética de lujo.
                </h1>
                <p className="mt-4 max-w-2xl text-sm text-divineCream/75 md:text-base">
                  Abre cada burger en un visor 360° y arma tu pedido con precios en tiempo real.
                </p>
              </motion.section>

              <section ref={refs.burgers} className="scroll-mt-28">
                <SectionShell
                  eyebrow="THE DIVINE COLLECTION"
                  title="Hamburguesas"
                  subtitle="Ingredientes premium, perfiles umami y una presentación impecable."
                >
                  <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    {burgers.map((p) => (
                      <ProductCard
                        key={p.id}
                        product={p}
                        badge="VER 360°"
                        onClick={() => setActiveBurger(p)}
                        onAdd={() => addToCart({ id: p.id, name: p.name, price: p.price })}
                      />
                    ))}
                  </div>
                </SectionShell>
              </section>

              <section ref={refs.desserts} className="scroll-mt-28">
                <SectionShell
                  eyebrow="EXQUISITE DESSERTS"
                  title="Postres"
                  subtitle="Pastelería fina: contraste, textura y final elegante."
                >
                  <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    {desserts.map((p) => (
                      <ProductCard
                        key={p.id}
                        product={p}
                        badge="PATISSERIE"
                        onClick={() => addToCart({ id: p.id, name: p.name, price: p.price })}
                        onAdd={() => addToCart({ id: p.id, name: p.name, price: p.price })}
                      />
                    ))}
                  </div>
                </SectionShell>
              </section>

              <section ref={refs.yogurt} className="scroll-mt-28">
                <SectionShell
                  eyebrow="GREEK YOGURT DE MÁQUINA"
                  title="Yogurt"
                  subtitle="Elige tamaño, sabor y toppings como un bar premium."
                >
                  <YogurtMachineBuilder onAddToCart={addToCart} />
                </SectionShell>
              </section>

              <section ref={refs.atelier} className="scroll-mt-28">
                <SectionShell
                  eyebrow="ATELIER"
                  title="Arma tu Hamburguesa"
                  subtitle="Configurador paso a paso con resumen en vivo y cálculo automático."
                >
                  <BurgerBuilder onAddToCart={addToCart} />
                </SectionShell>
              </section>
            </main>

            <CartButton cartCount={cartCount} onClick={() => setCartOpen(true)} />

            <AnimatePresence>
              {cartOpen && (
                <CartDrawer items={cartItems} total={cartTotal} onClose={() => setCartOpen(false)} onQty={updateQty} />
              )}
            </AnimatePresence>

            <AnimatePresence>
              {!!activeBurger && (
                <ProductModal
                  product={activeBurger}
                  onClose={() => setActiveBurger(null)}
                  onAdd={() => addToCart({ id: activeBurger.id, name: activeBurger.name, price: activeBurger.price })}
                />
              )}
            </AnimatePresence>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
